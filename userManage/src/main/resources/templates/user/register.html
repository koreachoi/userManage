<!DOCTYPE html>
<html>

<body>
	<div th:replace="common/header :: header"></div>
	<br>
	<form th:action="@{/employeeRegister}" method="post" 　onsubmit="return validateRegisterForm();">
		<div class="border rounded p-3 mb-3">
			<h5>基本情報</h5>
			<hr>
			<div class="mb-3 row">
				<label for="syainId" class="col-sm-2 col-form-label">社員コード:</label>
				<div class="col-sm-4">
					<input type="text" id="syainId" name="syainId" th:value="${syainId}" class="form-control" />
				</div>
			</div>

			<div class="mb-3 row">
				<label class="col-sm-2 col-form-label">社員名（漢字）:</label>
				<div class="col-sm-2">
					<input type="text" id="lastNameKanji" name="lastNameKanji" th:value="${lastNameKanji}"
						class="form-control" placeholder="姓" />
				</div>
				<div class="col-sm-2">
					<input type="text" id="firstNameKanji" name="firstNameKanji" th:value="${firstNameKanji}"
						class="form-control" placeholder="名" />
				</div>
				<div class="col-sm-2 align-self-center">
					<span class="text-danger fw-bold">必須</span>
				</div>
			</div>

			<!-- 性別 입력 영역 -->
			<div class="border rounded p-3 mb-3">
				<div class="mb-3 row align-items-center">
					<label class="col-sm-2 col-form-label mb-0">性別:</label>
					<div class="col-sm-10 d-flex align-items-center">
						<div class="form-check form-check-inline mb-0">
							<input class="form-check-input" type="radio" id="male" name="seibetu" value="1"
							       th:checked="${seibetu == null or seibetu == 1}" />
							<label class="form-check-label" for="male">男</label>
						</div>
						<div class="form-check form-check-inline mb-0">
							<input class="form-check-input" type="radio" id="female" name="seibetu" value="2"
							       th:checked="${seibetu == 2}" />
							<label class="form-check-label" for="female">女</label>
						</div>
					</div>
				</div>
			</div>
			
			<div class="border rounded p-3 mb-3">
				<h5>会社関連情報</h5>
				<hr>
				<!-- 所属会社 -->
				<div class="mb-3 row">
					<label for="syouzokuKaisya" class="col-sm-2 col-form-label">所属会社</label>
					<div class="col-sm-4">
						<select id="syouzokuKaisya" name="syouzokuKaisya" class="form-select">
							<option th:each="item : ${kaisyaList}" th:value="${item.category2}"
								th:text="${item.value1}">
							</option>
						</select>
					</div>

				</div>

				<!-- 入社日 -->
				<div class="mb-3 row">
					<label for="nyuusyaDate" class="col-sm-2 col-form-label">入社日</label>
					<div class="col-sm-4">
						<input type="date" id="nyuusyaDate" name="nyuusyaDate" class="form-control">
					</div>
				</div>

				<!-- 退社日 -->
				<div class="mb-3 row">
					<label for="taisyaDate" class="col-sm-2 col-form-label">退社日</label>
					<div class="col-sm-4 d-flex align-items-center">
						<input type="text" id="taisyaDate" name="taisyaDate" th:value="${taisyaDate}"
							class="form-control" />
						<span class="ms-2 small text-muted">※YYYY-MM-DD</span>
					</div>
				</div>

				<!-- 職業種類 -->
				<div class="mb-3 row">
					<label for="syokugyoKind" class="col-sm-2 col-form-label">職業種類</label>
					<div class="col-sm-4">
						<select id="syokugyoKind" name="syokugyoKind" class="form-select">
							<option th:each="item : ${syokugyoList}" th:value="${item.category3}"
								th:text="${item.value1}">
							</option>
						</select>
					</div>
				</div>
			</div>

			<div class="border rounded p-3 mb-3">
				<h5>給与関連情報</h5>
				<hr>
				<div class="table-responsive">
					<table class="table table-bordered align-middle text-center">
						<thead class="table-light">
							<tr>
								<th class="bg-primary-subtle text-primary">金融機関コード</th>
								<th class="bg-primary-subtle text-primary">金融機関名</th>
								<th class="bg-primary-subtle text-primary">支店コード</th>
								<th class="bg-primary-subtle text-primary">支店名</th>
								<th class="bg-primary-subtle text-primary">口座種類</th>
								<th class="bg-primary-subtle text-primary">口座番号</th>
								<th class="bg-primary-subtle text-primary">名義人</th>
							</tr>
						</thead>
						<tbody>
							<!-- 銀行コード～支店名のid名を、それぞれ bank_code、bank_name、branch_code、branch_name、にして下さい。-->
							<tr>
								<td>
									<input type="text" id="bank_code" name="bank_code"
										class="form-control text-center" />
								</td>
								<td>
									<input type="text" id="bank_name" name="bank_name"
										class="form-control text-center" />
								</td>
								<td>
									<input type="text" id="branch_code" name="branch_code"
										class="form-control text-center" />
								</td>
								<td>
									<input type="text" id="branch_name" name="branch_name"
										class="form-control text-center" />
								</td>
								<td>
									<select id="kouza_type" name="kouza_type" class="form-select text-center">
										<option value="">選択</option>
										<option value="普通">普通</option>
										<option value="当座">当座</option>
										<option value="貯蓄">貯蓄</option>
									</select>
								</td>
								<td>
									<input type="text" id="kouza_number" name="kouza_number"
										class="form-control text-center">
								</td>
								<td>
									<input type="text" id="meigi" name="meigi" class="form-control text-center">
								</td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
			<div class="border rounded p-3 mb-3">
				<h5>技術経験</h5>
				<hr>
				<p class="small">
					◎：実務経験１年以上 ／ ○：実務経験有り ／ △：知識有り
				</p>

				<div class="table-responsive">
					<table class="table table-bordered align-middle text-center">
						<thead class="table-light">
							<tr>
								<th class="bg-info text-white align-middle" style="width: 100px;">OS</th>
								<th colspan="10" class="text-center align-middle">技術名とレベル</th>
							</tr>
						</thead>
						<tbody>
							<tr th:each="row, stat : ${#numbers.sequence(0, osList.size() - 1, 5)}">
								<!-- OS 셀은 첫 줄에만 표시되며 rowspan 처리 -->
								<td th:if="${stat.index == 0}"
									th:rowspan="${T(java.lang.Math).ceil(osList.size() / 5.0)}"
									class="bg-info-subtle fw-bold align-middle">OS</td>

								<!-- 기술 항목 최대 5개 반복 -->
								<td class="text-end" th:each="i : ${#numbers.sequence(0, 4)}"
									th:if="${row + i < osList.size()}">
									<span th:text="${osList[row + i].value1}" class="me-2"></span>
									<select th:name="'tech[' + ${osList[row + i].value1} + ']'"
										class="form-select d-inline-block w-auto text-end">
										<option value="0"></option>
										<option value="1">△</option>
										<option value="2">○</option>
										<option value="3">◎</option>
									</select>
								</td>
								<!-- 빈 칸 채우기 (기술 수가 5개보다 적은 경우) -->
								<td class="text-end" th:each="i : ${#numbers.sequence(0, 4)}"
									th:if="${row + i >= osList.size()}"></td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>

			<div class="text-center mt-4 mb-5">
				<hr>
				<button type="submit" class="btn btn-primary px-4 fw-bold">
					登　録
				</button>
			</div>
	</form>
</body>

<script src="https://zipaddr.github.io/bankautoc.js" charset="UTF-8"></script>
<script>
	function validateRegisterForm() {
		const syainId = document.getElementById("syainId");
		const lastNameKanji = document.getElementById("lastNameKanji");
		const firstNameKanji = document.getElementById("firstNameKanji");

		// 社員コード 검사: 필수 + 영숫자 + 10자 이내
		const codeRegex = /^[A-Za-z0-9]{1,10}$/;
		const syainIdValue = syainId.value.trim();
		if (!syainIdValue) {
			alert("社員コードを入力してください。");
			syainId.focus();
			return false;
		}

		if (!/^[A-Za-z0-9]+$/.test(syainIdValue)) {
			alert("社員コードは英数字,数字で入力してください。");
			syainId.focus();
			return false;
		}
		if (syainIdValue.length > 10) {
			alert("社員コードは10文字以内で入力してください。");
			syainId.focus();
			return false;
		}

		// 姓 (全角 / 15자 이내)
		const lastName = lastNameKanji.value.trim();
		if (!lastName) {
			alert("姓(漢字)を入力してください。");
			lastNameKanji.focus();
			return false;
		}
		if (!/^[^\x01-\x7E\xA1-\xDF]+$/.test(lastName)) {
			alert("姓(漢字)は全角文字で入力してください。");
			lastNameKanji.focus();
			return false;
		}
		if (lastName.length > 15) {
			alert("姓(漢字)は15文字以内で入力してください。");
			lastNameKanji.focus();
			return false;
		}

		// 名 (全角 / 15자 이내)
		const firstName = firstNameKanji.value.trim();
		if (!firstName) {
			alert("名(漢字)を入力してください。");
			firstNameKanji.focus();
			return false;
		}
		if (!/^[^\x01-\x7E\xA1-\xDF]+$/.test(firstName)) {
			alert("名(漢字)は全角文字で入力してください。");
			firstNameKanji.focus();
			return false;
		}
		if (firstName.length > 15) {
			alert("名(漢字)は15文字以内で入力してください。");
			firstNameKanji.focus();
			return false;
		}

		return true;
	}
	
	// 오늘 날짜를 yyyy-mm-dd 형식으로 변환
	const today = new Date().toISOString().split('T')[0];
	document.getElementById('nyuusyaDate').value = today;
</script>

</html>